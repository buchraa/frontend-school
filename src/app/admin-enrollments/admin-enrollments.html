<div class="space-y-6">
  @if (vm$ | async; as vm) {

    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
      <div>
        <h1 class="text-xl font-semibold text-gray-900">Demandes d’inscription</h1>
        <p class="text-xs text-gray-500">Gestion et validation des inscriptions</p>
      </div>

      <div class="flex gap-2 text-xs">
        <select
          class="border rounded px-2 py-1"
          [ngModel]="statusFilter()"
          (ngModelChange)="statusFilter.set($event)"
        >
          <option value="ALL">Tous</option>
          <option value="SUBMITTED">Soumis</option>
          <option value="UNDER_REVIEW">En étude</option>
          <option value="PENDING_TEST">Test</option>
          <option value="VALIDATED">Validé</option>
          <option value="REJECTED">Refusé</option>
        </select>

        <input
          class="border rounded px-2 py-1"
          placeholder="Recherche famille / parent"
          [ngModel]="search()"
          (ngModelChange)="search.set($event)"
        />
      </div>
    </div>

    <!-- States -->
    @if (vm.loading) {
      <div class="text-sm text-gray-500">Chargement…</div>
    }

    @if (vm.error) {
      <div class="text-sm text-red-600">{{ vm.error }}</div>
    }

    @if (!vm.loading && !vm.requests.length) {
      <div class="text-sm text-gray-500">Aucune demande trouvée.</div>
    }

    <!-- Table -->
    @if (!vm.loading && vm.requests.length) {
      <div class="bg-white rounded shadow overflow-hidden">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-50 border-b">
            <tr>
              <th class="px-4 py-2 text-left">Code Famille</th>
              <th class="px-4 py-2 text-left">Nom du Parent</th>
              <th class="px-4 py-2 text-left">Statut</th>
              <th class="px-4 py-2 text-right">Actions</th>
            </tr>
          </thead>

          <tbody>
            @for (r of vm.requests; track $index ) {
              <tr class="border-b hover:bg-gray-50">
                <td class="px-4 py-2">{{ r.familyCode || '—' }}</td>
                <td class="px-4 py-2">{{ r.familyName || '—' }}</td>

                <td class="px-4 py-2">
                  <span class="px-2 py-1 rounded text-xs bg-gray-100">
                    {{ r.status }}
                  </span>
                </td>

                <td class="px-4 py-2 text-right">
                  <div class="inline-flex gap-1">
                    <a
                      [routerLink]="['/admin/enrollment', r.id]"
                      class="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200"
                    >
                      Gérer
                    </a>



                    <button
                      class="px-2 py-1 text-xs rounded bg-green-100"
                      (click)="updateStatus(r, 'VALIDATED')"
                      [disabled]="savingId() === r.id"
                    >
                      Valider
                    </button>

                    <button
                      class="px-2 py-1 text-xs rounded bg-red-100"
                      (click)="updateStatus(r, 'REJECTED')"
                      [disabled]="savingId() === r.id"
                    >
                      Refuser
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  }
</div>
